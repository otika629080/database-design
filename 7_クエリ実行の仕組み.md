# この章で学ぶこと
- SQLの論理的な実行順序を理解
- JOINアルゴリズム(NLJ)の動作原理
- 駆動表と内部表の概念
- オプティマイザの自動最適化の仕組み

## SELECTの時にテーブルをどのように扱っているのか
InnoDBはレコードをページ単位でまとめて扱う

テーブルの結合にはNLJ(Nested Loop Join)のアルゴリズムを使う

## 駆動表と内部表
駆動表: JOINにおいて最初にアクセスされるテーブル

内部表: JOINにおいて駆動表に結合するテーブル

駆動表と内部表はオプティマイザが自動で決定(基本はレコード少ない方が駆動表)

WHEREで絞り込んだ方が大幅に減るなら事前に絞り込む事もある

### NLJ(Nested Loop Join)
```sql
SELECT * FROM A INNER JOIN B
ON A.id = B.a_id
WHERE A.id = 'xxx'
```
```kotlin
val joinedRecord = Record[]

for recordA in pageA
    val pageB = findPage(recordA.id)
    for recordB in pageB
        if (recordB.a_id == recordA.id) {
            joinedRecord.add({ recordA, recordB })
        }
```

## NLJのインデックス上の動き
1. 駆動表のテーブルからレコードを取り出す
2. 内部表のセカンダリインデックスから一致するPKを取り出す
3. 内部表のクラスタインデックスからレコードを取り出す